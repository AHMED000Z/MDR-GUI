import streamlit as st
import os
import time

# Initialize session state for scanning to prevent multiple clicks
if 'malware_scan_in_progress' not in st.session_state:
    st.session_state.malware_scan_in_progress = False

def malware_scan():
    st.header("Malware Scan")

    # File uploader for drag-and-drop or browsing files
    uploaded_files = st.file_uploader("Choose a file to scan for malware", type=["exe", "dll", "bat", "com", "bin"], accept_multiple_files=True)

    # Check if files are uploaded and the scan button is pressed
    if uploaded_files:
        if st.button("Start Scan") and not st.session_state.malware_scan_in_progress:
            st.session_state.malware_scan_in_progress = True

            for uploaded_file in uploaded_files:
                st.write(f"Scanning file: {uploaded_file.name}")
                # Placeholder for actual malware scanning function

                # Simulate scanning delay (timer)
                with st.spinner("Malware scan in progress..."):
                    time.sleep(10)
                    st.write(f"**This file is safe:** {uploaded_file.name}")
            
            st.session_state.malware_scan_in_progress = False
        else:
            st.write("Click 'Start Scan' to begin malware scanning.")
    else:
        st.warning("Please upload a file to scan.")
